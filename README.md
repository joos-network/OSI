# OSI
Модель OSI

# L2-сеть

**Канальный уровень (Data Link layer)** - это второй уровень в модели OSI, определяет способы передачи данных между устройствами, находящимися в одном сегменте сети

**Решаемые проблемы**
- Обнаружение ошибок физического уровня
- Одновременная передача данных разным устройствам
- Аппаратная адресация

**Сегмент сети** - логически или физически обособленная часть сети

**Трафик в сети:**
- Broadcast трафик - от одного хоста ко всем хостам в сети - используют для служебного трафика
- - Определения нужного адреса
- - Получения настроек
- - Поиска сервера DHCP
- Unicast трафик - от одного хоста к другому хосту - используют для обмена данными по клиент-серверной модели
- Multicast трафик - от одного хоста к некоторой ограниченной группе хостов - используют для рассылки сообщений ограниченной группе

**Виды сред передачи данных**
- Общая среда - метод реализации сетей, когда все устройства имеют доступ к среде передачи данных, используя ее одновременно для приема и передачи
- Коммутируемый доступ - метод построения сетей на основе выделения каналов приема-передачи от конечных устройств к коммутаторам, которые обеспечивают маршрутизацию данных на основе адреса получателя

**Стандарты связи**
- Полудуплексный режим - один и тот же канал может использоваться или для передачи или для приема, но не одновременно
- Дуплексный режим - приём и передача могут осуществляться одновременно за счет физического разделения соответствующих каналов

**Домен коллизий** - часть сети Ethernet, все узлы которой конкурируют за общую разделяемую среду передачи и, следовательно, каждый узел которой может создать коллизию с любым другим узлом этой части сети

**Широковещательный домен** - метод доставки сообщений, при котором сообщение получают сразу все участники обмена (связи)

**Протокол Ethernet IEEE 802.3**
- Протоколы канального уровня отвечают за доставку данных внутри одного сегмента сети
- Сегмент сети (согласно IEEE 802.3) электрически соединенные устройства, использующие общую среду

**MAC-адрес (Media Access Control)** - аппаратный номер оборудования (компьютера, сервера, порта коммутатора и прочее), который присваивается сетевой карте в момент его производства

**MTU (Maximum Transmission Unit)** - максимальный размер полезного блока данных одного пакета (англ. payload), который может быть передан протоколом без фрагментации

**Address Resolution Protocol** - Протокол определения адреса - протокол в компьютерных сетях, предназначенный для определения IP-адреса по известному MAC-адресу узла и наоборот

**Двухуровневая адресация** - необходима для глобальной адресации узлов интернет сети, при этом каждый узел имеет уникальный локальный адрес внутри своей сети и каждая сеть имеет свой идентификатор

**Tcpdump** - утилита, позволяющая перехватывать и анализировать сетевой трафик, проходящий через компьютер, на котором запущена данная программа

**STP (Spanning Tree Protocol)** - Протокол остовного дерева - канальный протокол, основной задачей которого является устранение петель в топологии произвольной сети Ethernet

**LAN (Local Area Network)** - локальная компьютерная сеть, соединяющая компьютеры на небольшой территории, такой как офисные здания, университеты, здания

**VLAN (Virtual Local Area Network)** - Виртуальная локальная вычислительная сеть - логически обособленный сегмент локальной сети внутри одной физической сети. VLAN - технология, которая позволяет строить виртуальные сети с независимой от физических устройств топологией

# L3-сеть

**Сетевой уровень** - это третий уровень в модели OSI, который определяет способы передачи данных между устройствами, находящимися в разных сетях (сегментах сети)

Решаемые проблемы:
- Логическая адресация
- Построение маршрутов между сетями
- Диагностика сети

**Маска подсети** - битовая маска для определения по IP-адресу адреса подсети и адреса узла (хоста, компьютера, устройства) этой подсети

**IP (Internet Protocol)** - создан для использования во взаимосвязанных системах компьютерных сетей с коммутацией пакетов

Назначение IPv4
- Логическая адресация хостов на основе IP-адреса
- Инкапсуляция данные вышестоящих протоколов
- Маршрутизация данных между хостами
- Фрагментация IP-пакетов

Ограничения IPv4
- не устанавливает соединения
- не гарантирует доставку
- не обеспечивает обеспечения сохранение последовательности данных при передаче
- не устраняет возможное дублирования пакетов

**CIDR (Classless Inter-Domain Routing)** - метод IP-адресации, позволяющий гибко управлять пространством IP-адресов, не используя жёсткие рамки классовой адресации, возможно применение различных масок подсетей к различным подсетям

**Маска сети** - количество бит в адресе, которое отведено под адрес сети

**Адрес сети** (192.168.0.0) - позволяет определить, что хосты находятся в одной сети

**Широковещательный адрес сети** (192.168.0.255) - пакеты с широковещательным адресом получат все хосты этой сети
```
~$ netmask -r 192.168.38.32/20
192.168.32.0-192.168.47.255  (4096)
```
```
~$ ipcalc 192.168.38.32/20
Address:   192.168.38.32        11000000.10101000.0010 0110.00100000
Netmask:   255.255.240.0 = 20   11111111.11111111.1111 0000.00000000
Wildcard:  0.0.15.255           00000000.00000000.0000 1111.11111111
=>
Network:   192.168.32.0/20      11000000.10101000.0010 0000.00000000
HostMin:   192.168.32.1         11000000.10101000.0010 0000.00000001
HostMax:   192.168.47.254       11000000.10101000.0010 1111.11111110
Broadcast: 192.168.47.255       11000000.10101000.0010 1111.11111111
Hosts/Net: 4094                  Class C, Private Internet
```
**IPv6** - новый стандарт протокола IP, призванный исправить недостатки IPv4

Преимущества IPv6
- Увеличенное адресное пространство (128 бит)
- Автоконфигурация (не нужно настраивать адреса вручную)
- Jumbogram (передача до 4 Гб данных в одном пакете)

IPv6 трафик может быть:
- Unicast - Обычный трафик хоста
- Anycast - Групповой трафик, пакет будет доставлен наиболее близкому хосту с точки зрения протокола маршрутизации
- Multicast - Групповой трафик, пакеты будут доставлены каждому хосту в группе
- Broadcast - Не реализован

**Задача маршрутизатора** - объединение сетей на сетевом уровне. При работе маршрутизатор вынужден подменять MAC- адрес запроса на свой собственный MAC-адрес в другом сегменте

**Статическая маршрутизация** - вид маршрутизации, при котором маршруты указываются в явном виде при конфигурации маршрутизатора. Вся маршрутизация при этом происходит без участия каких- либо протоколов маршрутизации

**Динамическая маршрутизация** -  вид маршрутизации, при котором таблица маршрутизации редактируется программно

**TTL (Time To Live)** - время жизни пакета данных в протоколе IP (предельно допустимое время его пребывания в системе). Данное свойство используется в traceroute. Используя src IP и метки времени, traceroute узнает трассу прохождения пакета и время его прохождения

# L4-сеть

**Транспортный уровень** - Определяет способы доставки данных, то есть сам механизм передачи данных

Решаемые проблемы:
- Мультиплексирование - может работать с несколькими потоками данных между двумя устройствами
- Надежная передача данных
- Регулирование количества передаваемых данных
- Контроль доставки данных

Единицы и протоколы:
- TCP - сегмент
- UDP - дейтаграмма

**TCP (Transmission Control Protocol - протокол управления передачей)** - Передает данные между приложениями (например, интернет-браузер) и web-службами

Назначение протокола TCP:
- Надежная доставка данных - осуществляется автоматической повторной пересылкой пропавших сегментов
- Сборка сегментов на стороне получателя - TCP получателя собирает пакеты как надо, если они пришли не в "правильном" порядке
- Контроль сессии - Перед началом передачи данных, TCP всегда проверяет, что получатель существует и готов принимать данные
- Контроль скорости передачи данных - Отправитель может динамически менять размер пересылаемых данных, анализируя подтверждения от получателя, благодаря механизму скользящего окна
- Мультиплексирование - процедура приема данных протоколами TCP и UDP, поступающих от нескольких различных прикладных служб

**Трехстороннее рукопожатие** - процесс установки надежного, полнодуплексного соединения, где оба канала могут передавать информацию одновременно, а также они синхронизируют и подтверждают друг друга (готов общаться - готов - начинаю говорить)

**Техника скользящего окна** -  особенность протокола TCP, которая используется для подбора оптимального количества отправляемых пакетов с сохранением надежной упорядоченной доставки пакетов, а также используется для повышения эффективности, когда канал может иметь большую задержку. TCP постоянно анализирует время прохождения подтверждений и адаптирует размер окна под пропускную способность

**Заголовок TCP** - служебная информация (метаданные), которая добавляется к полезной нагрузке (payload) на транспортном уровне для решения всех задач протокола TCP
- Номер портов получателя и отправителя
- Порядковый номер, Номер подтверждения
- Длина самого заголовка TCP
- Размер окна
- Признак важности данного сегмента
- ASK - содержит значение номера подтверждения в поле подтверждения\
- PSH - получатель передает данные из буфера в приложение и сразу же отправляет сообщение с подтверждением
- RST - сбрасывает соединения
- SYN - создает соединения
- FIN - завершает соединения

**Мультиплексирование** - процедура приема данных протоколами TCP и UDP, поступающих от нескольких различных прикладных служб
- Для того, чтобы понимать какой процесс посылает или принимает данные, применяется метод определения конечной точки транспортного уровня
- Порт - адрес транспортного уровня
- Номер порта - идентификатор приложения на хосте получателя и/или отправителя
- 0 - 1023 - общеизвестные / системные
- 1024 - 49151 - зарегистрированные / пользовательские - Зарегистрированные программы или протоколы
- 49152 - 65535 - динамические / частные - Создания исходящих соединений с различными сервисами

**Сетевой сокет** - структура, которая определяет конечную точку во время сетевого обмена данными

Для TCP/IP сокетом является сочетание трех параметров сессии
- Транспортного протокола (TCP, UDP)
- Номера порта
- IP-адреса

**Парные сокеты** - локальный и соответствующий удаленный сокеты (Парный сокет имеет вид T.55000:IP1<->80:IP2)

**Типы сокетов по подключению**
- Потоковый (TCP)
- Сокет дейтаграмм (UDP)
- Сырой (raw) сокет (IP-пакет с данными)

**Установление соединения** - процесс обмена между двумя удаленными точками, в результате которого стороны начинают обмен информацией. Протокол TCP устанавливает соединение с помощью трехстороннего рукопожатия

![tcp](https://github.com/joos-network/OSI/blob/main/tcp.png)

Нормальное завершение TCP-соединения происходит в виде двухстороннего рукопожатия
- Оба хоста закрывают свои сокеты
- Освобождают занятые во время сеанса ресурсы

![tcpclose](https://github.com/joos-network/OSI/blob/main/tcpclose.png)

**RST** - флаг прерывания соединения, используется для отказа в соединении 
**Флаг RST** – сброс - Если этот флаг установлен в 1 Хост должен немедленно прекратить обмен и закрыть со своей стороны сокет. Данный механизм нужен для уведомления противоположной стороны о произошедшем сбое

**Протокол UDP (User Datagram Protocol — протокол пользовательских датаграмм)**
- «Рабочая лошадка» всех потоковых сервисов и геймдева
- Обеспечивает работу современных цифровых сервисов
- Основа DNS

Назначение протокола UDP
- Ориентирован на транзакции (запрос – ответ), например, DNS или NTP
- Простой протокол, для которого не требуется сложная модель обмена данными
- Не сохраняет состояния соединения – подходит для рассылки большому количеству хостов (IPTV)
- Отсутствуют повторные передачи, что позволяет работать в режиме реального времени (игры)
- Поддерживает многоадресную рассылку (Precision Time Protocol and Routing Information Protocol)

**Заголовок протокола UDP**
- Номер портов получателя и отправителя
- Длина
- Контрольная сумма

**Multicast** - режим передачи данных, в котором данные передаются группе хостов

**Преимущество многоадресного вещания** - Часть информации для разных клиентов передается один раз по «общему» маршруту = Снижается нагрузка на пропускную способность сети (Потоковое аудио и видео, Интернет-телевидение)

**DNS** - система, предназначенная для получения информации о доменах

**Режим работы DNS** - Запрос – ответ = обмениваясь короткими сообщениями

**Telnet** - одна из самых популярных утилит для проверки «открытости» TCP порта

**Nmap** - одна из самых популярных утилит для сканирования хостов в сетях – как внутренних, так и внешних – на открытые порты

**SS (Socket statistics)** - наиболее актуальная утилита для сбора информации о сокетах, в частности сетевых сокетах

**Lsof** - мощная утилита, в том числе для получения информации по сети, Lsof поможет узнать, какому процессу принадлежит прослушиваемый порт (sudo lsof -ni :10050 = zabbix-agent)



